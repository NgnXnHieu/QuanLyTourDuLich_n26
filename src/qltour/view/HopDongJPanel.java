
package qltour.view;
import java.time.LocalDate;
import java.util.ArrayList;
import javax.swing.JOptionPane;
import javax.swing.ListSelectionModel;
import javax.swing.plaf.OptionPaneUI;
import javax.swing.table.DefaultTableModel;
import qltour.model.Tour;
import qltour.model.KhachHang;
import qltour.model.HopDong;
import qltour.managedata.IO;
import javax.swing.JTable;
import javax.swing.ListSelectionModel;
import javax.swing.GroupLayout.Alignment;
import javax.swing.GroupLayout;
import java.awt.Checkbox;
import java.awt.Color;
import java.util.ArrayList;
import javax.swing.border.LineBorder;
import javax.swing.event.AncestorEvent;
import javax.swing.event.AncestorListener;
import javax.swing.JScrollPane;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

import qltour.check_loi.check_Loi;
import qltour.managedata.IO;
import qltour.model.HopDong;
import qltour.model.KhachHang;
import qltour.model.Tour;

import javax.swing.SwingConstants;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.GridLayout;
import java.awt.Label;
import java.awt.SystemColor;
import java.awt.event.ActionListener;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.time.LocalDate;

import javax.swing.LayoutStyle.ComponentPlacement;
import javax.swing.border.CompoundBorder;
import javax.swing.JComboBox;
import javax.swing.JDialog;

import java.awt.Component;
import java.awt.Dialog;

import javax.swing.JTextField;
import javax.swing.JRadioButton;
import javax.swing.JScrollBar;
import javax.swing.JButton;
import javax.swing.ButtonGroup;
import java.awt.event.ActionEvent;
import javax.swing.AbstractAction;
import javax.swing.Action;
import java.awt.Font;
import javax.swing.JPanel;
import java.awt.Window;
public class HopDongJPanel extends javax.swing.JPanel {
	private JTable table;
	static IO o = new IO();
	ArrayList<HopDong> listHD = new ArrayList<HopDong>();
	private ArrayList<KhachHang> listKH;
	private ArrayList<Tour> listTour;
	private JButton btnAdd;
	private JButton btnXoa;
	private JButton btnSua;
	private JDialog edit_jDialog;
	private JLabel lb1;
	private JTextField tf1, tf2;
	private JLabel lb_mahopdong, lb_NgayLap, lb_maTour, lb_KH, lb_Trangthai;
	private JTextField tf_MHD, tf_NgayLap;
	private JComboBox comboBox_MKH;
	private JComboBox comboBox_MaTour;
	private JRadioButton RB1;
	private JRadioButton RB2;
	private JButton btnedit,btnadd;

	private final ButtonGroup buttonGroup = new ButtonGroup();
	private JLabel lblNewLabel;
	/**
	 * @wbp.nonvisual location=474,149
	 */
	/**
	 * @wbp.nonvisual location=371,449
	 */
	private JDialog dialog = new JDialog();

	public HopDongJPanel() {

		initComponents();
		setTable();
	}

	private void setTable() {
		DefaultTableModel defaultTableModel = new DefaultTableModel();
		table.setBackground(new Color(204, 255, 255));
		table.setModel(defaultTableModel);
		ListSelectionModel listSelectionModel = table.getSelectionModel();
		listSelectionModel.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
		defaultTableModel.addColumn("STT");
		defaultTableModel.addColumn("Mã hợp đồng");
		defaultTableModel.addColumn("Mã tour");
		defaultTableModel.addColumn("Mã khách hàng");
		defaultTableModel.addColumn("Ngày lập");
		defaultTableModel.addColumn("Trạng thái thanh toán");
		listHD = o.loadData(listHD, "dsHD.dat");
		int i = 0;
		for (HopDong Hopdong : listHD) {
			i++;
			defaultTableModel.addRow(new Object[] { i, Hopdong.getID_HopDong(), Hopdong.getMaTour(), Hopdong.getMaKh(),
					Hopdong.getNgayLap(), Hopdong.getTrangThai() });
		}
		JScrollPane jScrollPane = new JScrollPane();
		table.add(jScrollPane);
	}

	/**
	 * This method is called from within the constructor to initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is always
	 * regenerated by the Form Editor.
	 */
	@SuppressWarnings("unchecked")
	// <editor-fold defaultstate="collapsed" desc="Generated
	// Code">//GEN-BEGIN:initComponents
	private void initComponents() {
		edit_jDialog = new JDialog();
		table = new JTable();
		listKH = new ArrayList<KhachHang>();
		listTour = new ArrayList<Tour>();

		setBackground(new Color(176, 224, 230));

		JScrollPane scrollPane = new JScrollPane();
		scrollPane.setBackground(new Color(153, 204, 153));
		comboBox_MKH = new JComboBox();
		comboBox_MKH.setFont(new Font("Tahoma", Font.PLAIN, 14));
		listKH = o.loadData(listKH, "dsKh.dat");
		for (KhachHang kh : listKH) {
			comboBox_MKH.addItem(kh.getID_client());
		}
		comboBox_MaTour = new JComboBox();
		comboBox_MaTour.setFont(new Font("Tahoma", Font.PLAIN, 14));
		listTour = o.loadData(listTour, "dsTour1.dat");
		for (Tour t : listTour) {
			comboBox_MaTour.addItem(t.getID_Tour());
		}

		table.addMouseListener(new MouseListener() {

			@Override
			public void mouseReleased(MouseEvent e) {
				// TODO Auto-generated method stub

    public HopDongJPanel() {
        o =new IO();
        listHD = new ArrayList<HopDong>();
        initComponents();

			}

			@Override
			public void mousePressed(MouseEvent e) {
				// TODO Auto-generated method stub

			}

			@Override
			public void mouseExited(MouseEvent e) {
				// TODO Auto-generated method stub

			}

			@Override
			public void mouseEntered(MouseEvent e) {
				// TODO Auto-generated method stub

			}

			@Override
			public void mouseClicked(MouseEvent e) {
				// TODO Auto-generated method stub
				tf_MHD.setText(listHD.get(table.getSelectedRow()).getID_HopDong());
				tf_NgayLap.setText(listHD.get(table.getSelectedRow()).getNgayLap());
				Object tmp1 = listHD.get(table.getSelectedRow()).getMaTour();
				comboBox_MaTour.setSelectedItem(tmp1);
				;
				Object tmp2 = listHD.get(table.getSelectedRow()).getMaKh();
				comboBox_MKH.setSelectedItem(tmp2);
				if (listHD.get(table.getSelectedRow()).getTrangThai().compareTo("Chưa thanh toán") == 0)
					RB2.setSelected(true);
				else
					RB1.setSelected(true);
			}
		});
		JButton btnAdd = new JButton("Thêm");
		btnAdd.setFont(new Font("Tahoma", Font.PLAIN, 14));
		btnAdd.addActionListener(new ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				add_jButtonActionPerformed(evt);
			}
		});
		btnXoa = new JButton("Xoá");
		btnXoa.setFont(new Font("Tahoma", Font.PLAIN, 14));
		btnXoa.addActionListener(new ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				del_jButtonActionPerformed(evt);
			}
		});

		btnSua = new JButton("Sửa");
		btnSua.setFont(new Font("Tahoma", Font.PLAIN, 14));

		btnSua.addActionListener(new ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				edit_jButtonActionPerformed(evt);
			}
		});
		lb_mahopdong = new JLabel("  Mã hợp đồng");
    	lb_KH= new JLabel("  Mã khách hàng");
    	lb_maTour =new JLabel("  Mã Tour");
    	lb_NgayLap= new JLabel("  Ngày lập");
    	lb_Trangthai = new JLabel("  Trạng thái");
    	 tf_MHD = new JTextField();
    	 tf_NgayLap = new JTextField();
         RB1 = new JRadioButton("Đã thanh toán");
         RB2 = new JRadioButton("Chưa thanh toán");

		JPanel panel = new JPanel();
		panel.setBackground(SystemColor.inactiveCaption);

		javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
		layout.setHorizontalGroup(
			layout.createParallelGroup(Alignment.TRAILING)
				.addComponent(panel, GroupLayout.DEFAULT_SIZE, 1026, Short.MAX_VALUE)
				.addComponent(scrollPane, GroupLayout.DEFAULT_SIZE, 1026, Short.MAX_VALUE)
				.addGroup(layout.createSequentialGroup()
					.addContainerGap(173, Short.MAX_VALUE)
					.addComponent(btnAdd, GroupLayout.PREFERRED_SIZE, 157, GroupLayout.PREFERRED_SIZE)
					.addGap(136)
					.addComponent(btnSua, GroupLayout.PREFERRED_SIZE, 157, GroupLayout.PREFERRED_SIZE)
					.addGap(116)
					.addComponent(btnXoa, GroupLayout.PREFERRED_SIZE, 157, GroupLayout.PREFERRED_SIZE)
					.addGap(130))
		);
		layout.setVerticalGroup(
			layout.createParallelGroup(Alignment.TRAILING)
				.addGroup(layout.createSequentialGroup()
					.addComponent(panel, GroupLayout.PREFERRED_SIZE, 92, GroupLayout.PREFERRED_SIZE)
					.addGap(37)
					.addComponent(scrollPane, GroupLayout.PREFERRED_SIZE, 263, GroupLayout.PREFERRED_SIZE)
					.addPreferredGap(ComponentPlacement.RELATED, 113, Short.MAX_VALUE)
					.addGroup(layout.createParallelGroup(Alignment.BASELINE)
						.addComponent(btnXoa, GroupLayout.PREFERRED_SIZE, 55, GroupLayout.PREFERRED_SIZE)
						.addComponent(btnSua, GroupLayout.PREFERRED_SIZE, 55, GroupLayout.PREFERRED_SIZE)
						.addComponent(btnAdd, GroupLayout.PREFERRED_SIZE, 55, GroupLayout.PREFERRED_SIZE))
					.addGap(188))
		);
		
		lblNewLabel = new JLabel("Quản Lý Hợp Đồng");
		panel.add(lblNewLabel);
		lblNewLabel.setFont(new Font("Tahoma", Font.PLAIN, 34));
		scrollPane.setViewportView(table);
		this.setLayout(layout);
	}// </editor-fold>//GEN-END:initComponents

	private void add_jButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_add_jButtonActionPerformed
        // TODO add your handling code here:
		
		
		dialog = new JDialog();
    	dialog.setAlwaysOnTop(true);
    	dialog.setTitle("Thêm Hợp Đồng");
    	dialog.setFont(new Font("Dialog", Font.PLAIN, 15));
    	JPanel jPanel_1= new JPanel();
    	jPanel_1.setLayout(new GridLayout(6,2,30,30));
    	dialog.getContentPane().setLayout(new GridLayout(2,1,30,0));
    	dialog.getContentPane().setBackground(new Color(176,224,230));
//    	lb_mahopdong = new JLabel("  Mã hợp đồng");
//    	lb_KH= new JLabel("  Mã khách hàng");
//    	lb_maTour =new JLabel("  Mã Tour");
//    	lb_NgayLap= new JLabel("  Ngày lập");
//    	lb_Trangthai = new JLabel("  Trạng thái");
//    	 tf_MHD = new JTextField();
//    	 tf_NgayLap = new JTextField();
//         RB1 = new JRadioButton("Đã thanh toán");
//         RB2 = new JRadioButton("Chưa thanh toán");
    	jPanel_1.add(lb_mahopdong);
    	jPanel_1.add(tf_MHD);
    	jPanel_1.add(lb_NgayLap);
    	jPanel_1.add(tf_NgayLap);
    	jPanel_1.add(lb_maTour);
    	jPanel_1.add(comboBox_MaTour);
    	jPanel_1.add(lb_KH);
    	jPanel_1.add(comboBox_MKH);
    	jPanel_1.add(lb_Trangthai);
    	JPanel jPanel = new JPanel(new FlowLayout());
    	jPanel.add(RB1);
    	jPanel.add(RB2);
    	JButton btnadd= new JButton("Thêm Hợp Đồng");
    	dialog.getContentPane().add(jPanel_1);
    	JPanel jPanel2 = new JPanel(new GridLayout(1,1,100,50));
    	jPanel2.add(btnadd);
    	jPanel_1.setBackground(new Color(176,224,230));
    	jPanel_1.add(jPanel);
    	jPanel_1.add(btnadd);
    	RB2.setSelected(true);
    	dialog.setSize(550,650);
    	RB1.addActionListener( new java.awt.event.ActionListener() {
			@Override
			public void actionPerformed(ActionEvent e) {
				RB2.setSelected(false);
				
			}
		});
    	RB2.addActionListener( new java.awt.event.ActionListener() {
			@Override
			public void actionPerformed(ActionEvent e) {
				RB1.setSelected(false);
				
			}
		});
    	btnadd.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                listHD = o.loadData(listHD, "dsHD.dat");
                String MaHD= tf_MHD.getText();
                String  MaKH=(String) comboBox_MKH.getSelectedItem()  ;
                tf_NgayLap.setText(String.valueOf(LocalDate.now()));
                String NgayLap= tf_NgayLap.getText();
                String trangThai="";
                if(RB1.isSelected()) trangThai="Đã thanh toán";
                else if(RB2.isSelected()) trangThai="Chưa thanh toán";
                String MaTour= (String) comboBox_MaTour.getSelectedItem();
                
                if(MaHD.isEmpty()) JOptionPane.showMessageDialog(dialog, "Không để trống thông tin","Lỗi",JOptionPane.ERROR_MESSAGE);
                else if(NgayLap.isEmpty()) JOptionPane.showMessageDialog(dialog, "Không để trống thông tin","Lỗi",JOptionPane.ERROR_MESSAGE);
                else {
                	boolean find = false;
                	for(HopDong hd : listHD) {
                		if(hd.getID_HopDong().compareTo(MaHD)==0) {
                			JOptionPane.showMessageDialog(dialog, "Trùng Mã Hợp Đồng","Lỗi",JOptionPane.ERROR_MESSAGE);
                			find = true ;
                    		break;
                		}
                		
                	}
                	if(!find) {
                		HopDong hd= new HopDong(MaHD,MaKH , NgayLap, trangThai,MaTour);
                        listHD.add(hd);
                        JOptionPane.showMessageDialog(dialog, "Thêm thành công","Thông báo",JOptionPane.INFORMATION_MESSAGE);
                        o.saveData(listHD, "dsHD.dat");
                        setTable();
                	}
                }
        }});
    	
//    	lb_mahopdong = new JLabel("  Mã hợp đồng");
//    	lb_KH= new JLabel("  Mã khách hàng");
//    	lb_maTour =new JLabel("  Mã Tour");
//    	lb_NgayLap= new JLabel("  Ngày lập");
//    	lb_Trangthai = new JLabel("  Trạng thái");
//    	 tf_MHD = new JTextField();
//    	 tf_NgayLap = new JTextField();
    	dialog.setBackground(Color.blue);
    	dialog.setVisible(true);
    	

    	
    }
     private void setTable() {
         DefaultTableModel defaultTableModel = new DefaultTableModel();
        table.setModel(defaultTableModel);
         ListSelectionModel listSelectionModel = table.getSelectionModel();
        listSelectionModel.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
        defaultTableModel.addColumn("STT");
        defaultTableModel.addColumn("Mã Hợp Đồng");
        defaultTableModel.addColumn("Mã Tour");
        defaultTableModel.addColumn("Mã Khách Hàng");
        defaultTableModel.addColumn("Ngày Lập");
        defaultTableModel.addColumn("Trạng thái");

        listHD = o.loadData(listHD, "dsHD.dat");
        int i = 0;
        for (HopDong h : listHD) {
            i++;
            defaultTableModel.addRow(new Object[]{i, h.getID_HopDong(),h.getMaTour(),h.getMaKh(),h.getNgayLap(),h.getTrangThai()});
        }

    }


    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        addDialog = new javax.swing.JDialog();
        jPanel1 = new javax.swing.JPanel();
        lb_trangthai = new javax.swing.JLabel();
        lb_mhd = new javax.swing.JLabel();
        text_MHD = new javax.swing.JTextField();
        lb_mt = new javax.swing.JLabel();
        lb_mkh = new javax.swing.JLabel();
        CB_mkh = new javax.swing.JComboBox<>();
        CB_mt = new javax.swing.JComboBox<>();
        RB2 = new javax.swing.JRadioButton();
        RB1 = new javax.swing.JRadioButton();
        addbtn = new javax.swing.JButton();
        jLabel2 = new javax.swing.JLabel();
        ediDialog = new javax.swing.JDialog();
        jPanel3 = new javax.swing.JPanel();
        lb_trangthai2 = new javax.swing.JLabel();
        lb_mhd1 = new javax.swing.JLabel();
        text_MHD1 = new javax.swing.JTextField();
        lb_mt1 = new javax.swing.JLabel();
        lb_mkh1 = new javax.swing.JLabel();
        CB_mkh1 = new javax.swing.JComboBox<>();
        CB_mt1 = new javax.swing.JComboBox<>();
        RB4 = new javax.swing.JRadioButton();
        RB3 = new javax.swing.JRadioButton();
        editbtn = new javax.swing.JButton();
        jLabel3 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        table = new javax.swing.JTable();
        jLabel1 = new javax.swing.JLabel();
        DeleteButton = new javax.swing.JButton();
        Addbutton = new javax.swing.JButton();
        EditButton = new javax.swing.JButton();

        addDialog.setBackground(new java.awt.Color(255, 204, 204));

        jPanel1.setBackground(new java.awt.Color(255, 204, 204));
        jPanel1.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lb_trangthai.setText("Trạng thái");
        jPanel1.add(lb_trangthai, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 250, 111, 34));

        lb_mhd.setText("Mã Hợp Đồng");
        jPanel1.add(lb_mhd, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 90, 111, 34));

        text_MHD.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                text_MHDActionPerformed(evt);
            }
        });
        jPanel1.add(text_MHD, new org.netbeans.lib.awtextra.AbsoluteConstraints(310, 100, 154, -1));

        lb_mt.setText("Mã Tour");
        jPanel1.add(lb_mt, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 140, 111, 34));

        lb_mkh.setText("Mã Khách hàng");
        jPanel1.add(lb_mkh, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 190, 111, 34));

        CB_mkh.setModel(new javax.swing.DefaultComboBoxModel<>());
        listKH = new ArrayList<KhachHang>();
        listKH = o.loadData(listKH, "dsKh.dat");
        for (KhachHang kh : listKH) {
            CB_mkh.addItem(kh.getID_client());
        }
        CB_mkh.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                CB_mkhActionPerformed(evt);
            }
        });
        jPanel1.add(CB_mkh, new org.netbeans.lib.awtextra.AbsoluteConstraints(310, 190, 150, 30));

        CB_mt.setModel(new javax.swing.DefaultComboBoxModel<>());
        listTour = new ArrayList<Tour>();
        listTour = o.loadData(listTour, "dsTour1.dat");
        for (Tour t : listTour) {
            CB_mt.addItem(t.getID_Tour());
        }
        CB_mt.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                CB_mtActionPerformed(evt);
            }
        });
        jPanel1.add(CB_mt, new org.netbeans.lib.awtextra.AbsoluteConstraints(310, 140, 150, 30));

        RB2.setText("Chưa thanh toán");
        RB2.setSelected(true);
        RB2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                RB2ActionPerformed(evt);
            }
        });
        jPanel1.add(RB2, new org.netbeans.lib.awtextra.AbsoluteConstraints(420, 260, -1, -1));

        RB1.setText("Đã thanh toán");
        RB1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                RB1ActionPerformed(evt);
            }
        });
        jPanel1.add(RB1, new org.netbeans.lib.awtextra.AbsoluteConstraints(310, 260, -1, -1));

        addbtn.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N
        addbtn.setText("Thêm");
        addbtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                addbtnActionPerformed(evt);
            }
        });
        jPanel1.add(addbtn, new org.netbeans.lib.awtextra.AbsoluteConstraints(190, 340, 150, 40));

        jLabel2.setFont(new java.awt.Font("Segoe UI", 1, 24)); // NOI18N
        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel2.setText("Thêm Hợp Đồng");
        jPanel1.add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 10, 290, 40));

        addDialog.getContentPane().add(jPanel1, java.awt.BorderLayout.CENTER);

        jPanel3.setBackground(new java.awt.Color(153, 204, 255));
        jPanel3.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lb_trangthai2.setText("Trạng thái");
        jPanel3.add(lb_trangthai2, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 250, 111, 34));

        lb_mhd1.setText("Mã Hợp Đồng");
        jPanel3.add(lb_mhd1, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 90, 111, 34));

        text_MHD1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                text_MHD1ActionPerformed(evt);
            }
        });
        jPanel3.add(text_MHD1, new org.netbeans.lib.awtextra.AbsoluteConstraints(310, 100, 154, -1));

        lb_mt1.setText("Mã Tour");
        jPanel3.add(lb_mt1, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 140, 111, 34));

        lb_mkh1.setText("Mã Khách hàng");
        jPanel3.add(lb_mkh1, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 190, 111, 34));

        CB_mkh1.setModel(new javax.swing.DefaultComboBoxModel<>());
        listKH = new ArrayList<KhachHang>();
        listKH = o.loadData(listKH, "dsKh.dat");
        for (KhachHang kh : listKH) {
            CB_mkh1.addItem(kh.getID_client());
        }
        CB_mkh1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                CB_mkh1ActionPerformed(evt);
            }
        });
        jPanel3.add(CB_mkh1, new org.netbeans.lib.awtextra.AbsoluteConstraints(310, 190, 150, 30));

        CB_mt1.setModel(new javax.swing.DefaultComboBoxModel<>());
        listTour = new ArrayList<Tour>();
        listTour = o.loadData(listTour, "dsTour1.dat");
        for (Tour t : listTour) {
            CB_mt1.addItem(t.getID_Tour());
        }
        CB_mt1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                CB_mt1ActionPerformed(evt);
            }
        });
        jPanel3.add(CB_mt1, new org.netbeans.lib.awtextra.AbsoluteConstraints(310, 140, 150, 30));

        RB4.setText("Chưa thanh toán");
        RB4.setSelected(true);
        RB4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                RB4ActionPerformed(evt);
            }
        });
        jPanel3.add(RB4, new org.netbeans.lib.awtextra.AbsoluteConstraints(420, 260, -1, -1));

        RB3.setText("Đã thanh toán");
        RB3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                RB3ActionPerformed(evt);
            }
        });
        jPanel3.add(RB3, new org.netbeans.lib.awtextra.AbsoluteConstraints(310, 260, -1, -1));

        editbtn.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N
        editbtn.setText("Sửa");
        editbtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                editbtnActionPerformed(evt);
            }
        });
        jPanel3.add(editbtn, new org.netbeans.lib.awtextra.AbsoluteConstraints(190, 330, 150, 40));

        jLabel3.setFont(new java.awt.Font("Segoe UI", 1, 24)); // NOI18N
        jLabel3.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel3.setText("Thêm Hợp Đồng");
        jPanel3.add(jLabel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 10, 290, 40));

        ediDialog.getContentPane().add(jPanel3, java.awt.BorderLayout.CENTER);

        setBackground(new java.awt.Color(0, 204, 204));
        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        table.setBackground(new java.awt.Color(153, 255, 153));
        table.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, "", null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null}
            },
            new String [] {
                "STT", "Mã Hợp Đồng", "Mã Tour", "Mã Khách Hàng", "Ngày lập", "Trạng thái thanh toán"
            }
        ));
        table.setSelectionBackground(new java.awt.Color(255, 255, 204));
        table.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tableMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(table);
        setTable();

        add(jScrollPane1, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 100, 980, 320));

        jLabel1.setBackground(new java.awt.Color(153, 153, 153));
        jLabel1.setFont(new java.awt.Font("Segoe UI", 1, 36)); // NOI18N
        jLabel1.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel1.setText("Quản Lý Hợp Đồng");
        add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(260, 10, 470, 60));

        DeleteButton.setBackground(new java.awt.Color(255, 153, 153));
        DeleteButton.setText("Xoá");
        DeleteButton.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        DeleteButton.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                DeleteButtonMouseClicked(evt);
            }
        });
        DeleteButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                DeleteButtonActionPerformed(evt);
            }
        });
        add(DeleteButton, new org.netbeans.lib.awtextra.AbsoluteConstraints(580, 490, 150, 60));

        Addbutton.setBackground(new java.awt.Color(255, 153, 153));
        Addbutton.setText("Thêm");
        Addbutton.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        Addbutton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                AddbuttonActionPerformed(evt);
            }
        });
        add(Addbutton, new org.netbeans.lib.awtextra.AbsoluteConstraints(60, 490, 150, 60));

        EditButton.setBackground(new java.awt.Color(255, 153, 153));
        EditButton.setText("Sửa");
        EditButton.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        EditButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                EditButtonActionPerformed(evt);
            }
        });
        add(EditButton, new org.netbeans.lib.awtextra.AbsoluteConstraints(330, 490, 150, 60));
    }// </editor-fold>//GEN-END:initComponents

    private void DeleteButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_DeleteButtonActionPerformed
        // TODO add your handling code here:
        if(table.getSelectedRow()<0){
            JOptionPane.showMessageDialog(dialog, "Chọn Hợp Đồng cần xoá", "Lỗi", JOptionPane.ERROR_MESSAGE);
        }else{
            listHD.remove(table.getSelectedRow());
            o.saveData(listHD, "dsHD.dat");
            o.loadData(listHD, "dsHD.dat");
            setTable();
            JOptionPane.showMessageDialog(dialog, "Xoá thành công", "Thông báo", JOptionPane.INFORMATION_MESSAGE);
        }
    }//GEN-LAST:event_DeleteButtonActionPerformed

    private void AddbuttonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_AddbuttonActionPerformed
        // TODO add your handling code here:
        addDialog.setVisible(true);
        addDialog.setSize(700,600);
    }//GEN-LAST:event_AddbuttonActionPerformed

    private void EditButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_EditButtonActionPerformed
        // TODO add your handling code here
        if(table.getSelectedRow()<0){
            JOptionPane.showMessageDialog(dialog, "Chọn Hợp Đồng cần Sửa", "Lỗi", JOptionPane.ERROR_MESSAGE);

        }else{
            ediDialog.setVisible(true);
        ediDialog.setSize(700,600);
        text_MHD1.setText(listHD.get(table.getSelectedRow()).getID_HopDong());
        OldID= text_MHD1.getText();
        }
    }//GEN-LAST:event_EditButtonActionPerformed

    private void DeleteButtonMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_DeleteButtonMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_DeleteButtonMouseClicked

    private void text_MHDActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_text_MHDActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_text_MHDActionPerformed

    private void RB1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_RB1ActionPerformed
        // TODO add your handling code here:
        RB1.setSelected(true);
        RB2.setSelected(false);
    }//GEN-LAST:event_RB1ActionPerformed

    private void addbtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_addbtnActionPerformed
        // TODO add your handling code here:
        String ID = text_MHD.getText().trim();
        String MaKH = (String)CB_mkh.getSelectedItem();
        String text_NgayLap= (String.valueOf(LocalDate.now()));
        String NgayLap = text_NgayLap;
        String MaTour = (String)CB_mt.getSelectedItem();
        String trangthai=null;
        if(RB1.isSelected()) trangthai =RB1.getText();
        else trangthai=RB2.getText();
        if(ID.isEmpty()){
            JOptionPane.showMessageDialog(dialog, "Không để trống thông tin", "Lỗi", JOptionPane.ERROR_MESSAGE);
        }else{
            boolean find= false;
        for(HopDong h : listHD ){
            if(h.getID_HopDong().compareTo(ID)==0){
                find =true;
                JOptionPane.showMessageDialog(dialog, "Trùng Mã Hợp Đồng","Lỗi",JOptionPane.ERROR_MESSAGE);
                break;
            }
        }
        if(find == false){
            HopDong h = new HopDong(ID, MaKH, NgayLap, trangthai, MaTour);
            listHD.add(h);
            o.saveData(listHD, "dsHD.dat");
            JOptionPane.showMessageDialog(dialog, "Thêm thành công","Thông báo",JOptionPane.INFORMATION_MESSAGE);
            setTable();
        }
        }
    }//GEN-LAST:event_addbtnActionPerformed

    private void tableMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tableMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_tableMouseClicked

    private void CB_mkhActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_CB_mkhActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_CB_mkhActionPerformed

    private void CB_mtActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_CB_mtActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_CB_mtActionPerformed

    private void RB2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_RB2ActionPerformed
        // TODO add your handling code here:
        RB2.setSelected(true);
        RB1.setSelected(false);
    }//GEN-LAST:event_RB2ActionPerformed

    private void text_MHD1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_text_MHD1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_text_MHD1ActionPerformed

    private void CB_mkh1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_CB_mkh1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_CB_mkh1ActionPerformed

    private void CB_mt1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_CB_mt1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_CB_mt1ActionPerformed

    private void RB4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_RB4ActionPerformed
        // TODO add your handling code here:
        RB4.setSelected(true);
        RB3.setSelected(false);
    }//GEN-LAST:event_RB4ActionPerformed

    private void RB3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_RB3ActionPerformed
        // TODO add your handling code here:
        RB3.setSelected(true);
        RB4.setSelected(false);
    }//GEN-LAST:event_RB3ActionPerformed

    private void editbtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_editbtnActionPerformed
        // TODO add your handling code here:
        if(text_MHD1.getText().isEmpty()){
            JOptionPane.showMessageDialog(dialog, "Không để trống thông tin", "Lỗi", JOptionPane.ERROR_MESSAGE);
        }else{
            boolean find= false;
        for(HopDong h : listHD ){
            if(h.getID_HopDong().compareTo(text_MHD1.getText())==0&&h.getID_HopDong().compareTo(OldID)!=0){
                find =true;
                JOptionPane.showMessageDialog(dialog, "Trùng Mã Hợp Đồng","Lỗi",JOptionPane.ERROR_MESSAGE);
                break;
            }
        }
        if(find == false){
            listHD.get(table.getSelectedRow()).setID_HopDong(text_MHD1.getText());
	    listHD.get(table.getSelectedRow()).setMaTour((String) CB_mt1.getSelectedItem());
            listHD.get(table.getSelectedRow()).setMaKh((String) CB_mkh1.getSelectedItem());
            String NgayLap= (String.valueOf(LocalDate.now()));
            listHD.get(table.getSelectedRow()).setNgayLap(NgayLap);
            if(RB3.isSelected()) listHD.get(table.getSelectedRow()).setTrangThai("Đã thanh toán");
            else listHD.get(table.getSelectedRow()).setTrangThai("Chưa thanh toán");
            o.saveData(listHD, "dsHD.dat");
            o.loadData(listHD, "dsHD.dat");
            JOptionPane.showMessageDialog(dialog, "Sửa thành công","Thông báo",JOptionPane.INFORMATION_MESSAGE);
            ediDialog.setVisible(false);
            setTable();
        }
        }
    }//GEN-LAST:event_editbtnActionPerformed


    private ArrayList<Tour> listTour;
    private ArrayList<KhachHang> listKH;
    private ArrayList<HopDong> listHD;
    private IO o;
    private javax.swing.JDialog dialog;
    String OldID;
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton Addbutton;
    private javax.swing.JComboBox<String> CB_mkh;
    private javax.swing.JComboBox<String> CB_mkh1;
    private javax.swing.JComboBox<String> CB_mt;
    private javax.swing.JComboBox<String> CB_mt1;
    private javax.swing.JButton DeleteButton;
    private javax.swing.JButton EditButton;
    private javax.swing.JRadioButton RB1;
    private javax.swing.JRadioButton RB2;
    private javax.swing.JRadioButton RB3;
    private javax.swing.JRadioButton RB4;
    private javax.swing.JDialog addDialog;
    private javax.swing.JButton addbtn;
    private javax.swing.JDialog ediDialog;
    private javax.swing.JButton editbtn;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JLabel lb_mhd;
    private javax.swing.JLabel lb_mhd1;
    private javax.swing.JLabel lb_mkh;
    private javax.swing.JLabel lb_mkh1;
    private javax.swing.JLabel lb_mt;
    private javax.swing.JLabel lb_mt1;
    private javax.swing.JLabel lb_trangthai;
    private javax.swing.JLabel lb_trangthai2;
    private javax.swing.JTable table;
    private javax.swing.JTextField text_MHD;
    private javax.swing.JTextField text_MHD1;
    // End of variables declaration//GEN-END:variables

	private void del_jButtonActionPerformed(java.awt.event.ActionEvent evt) {
		
		if (table.getSelectedRow() < 0)
			JOptionPane.showMessageDialog(this, "Vui lòng chọn hợp đồng cần xoá", "Lỗi",
					JOptionPane.ERROR_MESSAGE);
		else {
			listHD = o.loadData(listHD, "dsHD.dat");
			int index = table.getSelectedRow();
			System.out.println(index);
			listHD.remove(index);
			o.saveData(listHD, "dsHD.dat");
			setTable();
		}
	}

	private void edit_jButtonActionPerformed(java.awt.event.ActionEvent evt) {
//    	update_view_kh_jButtonActionPerformed(evt);
		if (table.getSelectedRow() < 0)
			JOptionPane.showMessageDialog(null, "Vui lòng chọn hợp đồng cần sửa", "Lỗi",
					JOptionPane.ERROR_MESSAGE);
		else {
			dialog = new JDialog();
	    	dialog.setAlwaysOnTop(true);
	    	dialog.setTitle("Sửa Hợp Đồng");
	    	dialog.setFont(new Font("Dialog", Font.PLAIN, 15));
	    	JPanel jPanel_1= new JPanel();
	    	jPanel_1.setLayout(new GridLayout(6,2,30,30));
	    	dialog.getContentPane().setLayout(new GridLayout(2,1,30,0));
	    	dialog.getContentPane().setBackground(new Color(176,224,230));
//	    	lb_mahopdong = new JLabel("  Mã hợp đồng");
//	    	lb_KH= new JLabel("  Mã khách hàng");
//	    	lb_maTour =new JLabel("  Mã Tour");
//	    	lb_NgayLap= new JLabel("  Ngày lập");
//	    	lb_Trangthai = new JLabel("  Trạng thái");
//	    	 tf_MHD = new JTextField();
//	    	 tf_NgayLap = new JTextField();
//	         RB1 = new JRadioButton("Đã thanh toán");
//	         RB2 = new JRadioButton("Chưa thanh toán");
	    	jPanel_1.add(lb_mahopdong);
	    	jPanel_1.add(tf_MHD);
	    	jPanel_1.add(lb_NgayLap);
	    	jPanel_1.add(tf_NgayLap);
	    	jPanel_1.add(lb_maTour);
	    	jPanel_1.add(comboBox_MaTour);
	    	jPanel_1.add(lb_KH);
	    	jPanel_1.add(comboBox_MKH);
	    	jPanel_1.add(lb_Trangthai);
	    	JPanel jPanel = new JPanel(new FlowLayout());
	    	jPanel.add(RB1);
	    	jPanel.add(RB2);
	    	btnedit= new JButton("Sửa Hợp Đồng");
	    	dialog.getContentPane().add(jPanel_1);
	    	JPanel jPanel2 = new JPanel(new GridLayout(1,1,100,50));
	    	jPanel2.add(btnedit);
	    	jPanel_1.setBackground(new Color(176,224,230));
	    	jPanel_1.add(jPanel);
	    	jPanel_1.add(btnedit);
	    	RB2.setSelected(true);
	    	dialog.setSize(550,650);
	    	RB1.addActionListener( new java.awt.event.ActionListener() {
				@Override
				public void actionPerformed(ActionEvent e) {
					RB2.setSelected(false);
					
				}
			});
	    	RB2.addActionListener( new java.awt.event.ActionListener() {
				@Override
				public void actionPerformed(ActionEvent e) {
					RB1.setSelected(false);
					
				}
			});
	    	table.addMouseListener(new MouseListener() {
				
				@Override
				// TODO Auto-generated method stub
						public void mouseReleased(MouseEvent e) {
				}
				@Override
				public void mousePressed(MouseEvent e) {
					// TODO Auto-generated method stub
				}
				@Override
				public void mouseExited(MouseEvent e) {
					// TODO Auto-generated method stub
				}
				@Override
				public void mouseEntered(MouseEvent e) {
					// TODO Auto-generated method stub
				}
				@Override
				public void mouseClicked(MouseEvent e) {
					// TODO Auto-generated method stub
					tf_MHD.setText(listHD.get(table.getSelectedRow()).getID_HopDong());
			    	tf_NgayLap.setText(listHD.get(table.getSelectedRow()).getNgayLap());
			    	Object tmp1 = listHD.get(table.getSelectedRow()).getMaTour();
			    	comboBox_MaTour.setSelectedItem(tmp1);;
			    	Object tmp2 = listHD.get(table.getSelectedRow()).getMaKh();
			    	comboBox_MKH.setSelectedItem(tmp2);
			    	if(listHD.get(table.getSelectedRow()).getTrangThai().compareTo("Chưa thanh toán")==0) RB2.setSelected(true);
			    	else RB1.setSelected(true);
				}
			});
	    	btnedit.addActionListener(new java.awt.event.ActionListener() {
	            public void actionPerformed(java.awt.event.ActionEvent evt) {
	            	listHD = o.loadData(listHD, "dsHD.dat");
	        		String mahd;
	        			mahd = listHD.get(table.getSelectedRow()).getID_HopDong();
	        			boolean find = false;
	        			if(tf_MHD.getText().compareTo("")==0) {
	        				JOptionPane.showMessageDialog(dialog, "Không để trống ID","Lỗi",JOptionPane.ERROR_MESSAGE);
	        			}else {
	        				for (HopDong hd : listHD) {
		        				if (hd.getID_HopDong().compareTo(tf_MHD.getText()) == 0) {
		        					if (tf_MHD.getText().compareTo(mahd) == 0)
		        						find = false;
		        					else {
		        						find = true;
		        						JOptionPane.showMessageDialog(dialog, "Không đặt trùng ID", "Thông báo",
		        								JOptionPane.ERROR_MESSAGE);
		        					}
		        					break;
		        				}
		        			}
		        			if (!find) {
		        				listHD.get(table.getSelectedRow()).setID_HopDong(tf_MHD.getText());
		        				listHD.get(table.getSelectedRow()).setMaTour((String) comboBox_MaTour.getSelectedItem());
		        				listHD.get(table.getSelectedRow()).setMaKh((String) comboBox_MKH.getSelectedItem());
		        				tf_NgayLap.setText(String.valueOf(LocalDate.now()));
		        				listHD.get(table.getSelectedRow()).setNgayLap(tf_NgayLap.getText());
		        				if (RB1.isSelected())
		        					listHD.get(table.getSelectedRow()).setTrangThai("Đã thanh toán");
		        				else
		        					listHD.get(table.getSelectedRow()).setTrangThai("Chưa thanh toán");
		        				JOptionPane.showMessageDialog(dialog, "Sửa thành công", "Thông báo", JOptionPane.INFORMATION_MESSAGE);
		        				o.saveData(listHD, "dsHD.dat");
		        				setTable();
		        				dialog.setVisible(false);
		        			}
	        			}
	        			
	        		

	        }});
	    	
	    	dialog.setBackground(Color.blue);
	    	dialog.setVisible(true);
		}
		
		
    	

    	
		

	}
}
